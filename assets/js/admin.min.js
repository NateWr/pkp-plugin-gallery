/*! pkp-plugin-gallery 2015-04-13 */
var pkppg=pkppg||{};pkppg.data=pkppg.data||pkppg_data,pkppg.cache=pkppg.cache||{},jQuery(document).ready(function(a){console.log("pkppg.form loaded"),pkppg.form={plugin:0,init:function(){this.cache={},this.cache.body=pkppg.cache.body||a("body"),this.cache.modal=a("#pkp-release-modal"),this.cache.fields=this.cache.modal.find(".pkp-release-fields"),this.cache.add=a(".pkp-release-form-buttons .add"),this.cache.save=this.cache.modal.find(".pkp-release-form-buttons .save"),this.cache.cancel=this.cache.modal.find(".pkp-release-form-buttons .cancel"),this.cache.status=this.cache.modal.find(".pkp-release-form-buttons .status"),this.cache.add.click(this.showReleaseForm),this.cache.cancel.click(this.hideReleaseForm),this.cache.modal.click(function(b){a(b.target).is(pkppg.form.cache.modal)&&pkppg.form.hideReleaseForm()}),a(document).keyup(function(a){"27"==a.which&&pkppg.form.hideReleaseForm()}),this.cache.save.click(this.save)},showReleaseForm:function(b){var c;"undefined"!=typeof b&&(b.stopPropagation(),b.preventDefault(),c=a(b.target).data("plugin")),pkppg.form.cache.body.addClass("pkppg-modal-is-visible"),pkppg.form.cache.modal.addClass("is-visible"),"undefined"!=typeof c&&(pkppg.form.plugin=c)},hideReleaseForm:function(a){"undefined"!=typeof a&&(a.stopPropagation(),a.preventDefault()),pkppg.form.cache.cancel.attr("disabled")||(pkppg.form.cache.body.removeClass("pkppg-modal-is-visible"),pkppg.form.cache.modal.removeClass("is-visible"),pkppg.form.cache.fields.find("input, textarea").val(""),pkppg.form.plugin=0)},save:function(b){if("undefined"!=typeof b&&(b.stopPropagation(),b.preventDefault()),!pkppg.form.cache.save.attr("disabled")){pkppg.form.setStatus("working");var c={};c.action="pkppg-submit-release",c.nonce=pkppg.data.nonce,c.release=pkppg.form.objectFromForm();var d=a.param(c);a.post(pkppg.data.ajaxurl,d,function(a){console.log(a),a.success?(pkppg.form.setStatus("success"),setTimeout(pkppg.form.hideReleaseForm,1e3)):pkppg.form.setStatus("error"),setTimeout(pkppg.form.resetStatus,4e3)})}},objectFromForm:function(){for(var a={},b=pkppg.form.cache.modal.find("form").serializeArray(),c=0;c<b.length;c++)a[b[c].name]=b[c].value;return this.plugin&&(a.plugin=this.plugin),a},setStatus:function(a){pkppg.form.cache.status.removeClass("working success error").addClass(a);var b="working"===a?!0:!1;pkppg.form.cache.save.attr("disabled",b),pkppg.form.cache.cancel.attr("disabled",b)},resetStatus:function(){pkppg.form.cache.status.removeClass("working success error"),pkppg.form.cache.save.attr("disabled",!1),pkppg.form.cache.cancel.attr("disabled",!1)}},pkppg.form.init(),console.log(pkppg)});